# MyKeyboardTyping - 練習素材管理仕様書

## 1. 概要

このドキュメントでは、タイピング練習の学習素材の定義、ローマ字↔ひらがな対応の仕様について記載します。

---

## 2. 練習素材の設計方針

### 2.1 素材の種類

現在実装されている練習素材:

1. **日本語基礎練習**
   - ひらがな基礎（あいうえお〜ぱぴぷぺぽ）
   - 拗音・促音（きゃきゅきょ、っ など）
   - 日常単語（よく使う単語20個）

2. **プログラミング練習（C#）**
   - 基本記号（`{}`, `[]`, `=>` など）
   - キーワード（`class`, `public`, `async` など）
   - コード例（実践的なコードスニペット）

### 2.2 素材の構造

- **ID**: 練習素材を一意に識別するID
- **タイトル**: ユーザーに表示される名前
- **コンテンツ**: 練習する単語の配列（複数単語による練習セット）
- **難易度**: `easy` / `normal` / `hard`
- **言語フラグ**: 日本語か英語かを示すフラグ

### 2.3 複数単語による練習

各練習素材は複数の単語で構成され、1単語ずつ順番に練習します:
- 各単語の末尾でEnterキー入力（`\n`）を行う
  - 日本語入力では通常、Enterキー入力が頻繁に行われるため
  - 自作キーボードではEnterキーの位置も通常と異なるケースがあるため
- 1単語完了すると自動的に次の単語に進む
- 全単語完了で完了画面を表示

---

## 3. ローマ字 ↔ ひらがな対応仕様

### 3.1 基本方針

- ひらがなに対して複数のローマ字入力パターンを許容
- ユーザーの入力に応じて動的にパターンを切り替え
- 一般的な日本語タイピングの慣習に準拠

### 3.2 複数パターン対応の例

**重要な複数パターン**:

| ひらがな | パターン1 | パターン2 | パターン3 |
|---------|----------|----------|----------|
| し | si | shi | ci |
| ち | ti | chi | |
| つ | tu | tsu | |
| ふ | hu | fu | |
| じ | zi | ji | |

**動的切り替えの動作**:
- 初期表示: `si` (最優先パターン)
- ユーザーが `sh` と入力 → 表示が `shi` に切り替わる
- これによりユーザーの入力習慣に柔軟に対応

### 3.3 拗音（小さい「ゃ」「ゅ」「ょ」）の仕様

**基本パターン**:
- きゃ: `kya`
- きゅ: `kyu`
- きょ: `kyo`
- （以下、他の行も同様）

**複数パターンを持つ拗音**:

| ひらがな | パターン1 | パターン2 | パターン3 |
|---------|----------|----------|----------|
| しゃ | sha | sya | |
| しゅ | shu | syu | |
| しょ | sho | syo | |
| ちゃ | cha | tya | |
| ちゅ | chu | tyu | |
| ちょ | cho | tyo | |
| じゃ | ja | jya | zya |
| じゅ | ju | jyu | zyu |
| じょ | jo | jyo | zyo |

**表示と判定**:
- 拗音は1つの単位として扱う（「き」と「ゃ」に分割しない）
- ひらがな表示とローマ字表示の単位を一致させる
- 理由: 入力進捗の管理を簡潔にするため

### 3.4 促音（小さい「っ」）の仕様

**入力方式1: 次の子音を重ねる（推奨）**

| 単語例 | ローマ字入力 | 説明 |
|--------|-------------|------|
| きって | kitte | ki + t + te |
| がっこう | gakkou | ga + k + ko + u |
| さっき | sakki | sa + k + ki |

**仕組み**:
- 「っ」は次の文字の最初の子音（t, k, s など）で表現
- 画面には子音1文字（`t`, `k` など）として表示
- ユーザーは次の文字の子音を入力することで「っ」を完了

**入力方式2: 直接入力（単独時のみ）**

| ひらがな | パターン1 | パターン2 | パターン3 |
|---------|----------|----------|----------|
| っ（単独） | ltu | xtu | ltsu |

**使い分け**:
- 次の文字がある場合: 子音重ね方式（方式1）を使用
- 次の文字がない場合、または母音で始まる場合: 直接入力方式（方式2）を使用

### 3.5 小書き文字（単独入力）

| ひらがな | パターン1 | パターン2 |
|---------|----------|----------|
| ぁ | la | xa |
| ぃ | li | xi |
| ぅ | lu | xu |
| ぇ | le | xe |
| ぉ | lo | xo |
| ゃ | lya | xya |
| ゅ | lyu | xyu |
| ょ | lyo | xyo |
| ゎ | lwa | xwa |

### 3.6 特殊文字

| 記号 | 入力 | 備考 |
|-----|------|------|
| ー | - | 長音符 |
| 、 | , | 読点 |
| 。 | . | 句点 |

---

## 4. 実装上の留意点

### 4.1 ローマ字マッピングの管理

- 全ての対応パターンは`useRomajiMapper.ts`で一元管理
- 最長一致による変換（「きゃ」などの3文字パターンを優先）
- パターンの優先順位は配列の順番で定義

### 4.2 促音の自動判定

- 「っ」を検出したら次の文字を先読み
- 次の文字の子音を取得して表示
- 入力判定時も次の子音との照合を行う

### 4.3 進捗管理

- ひらがな文字列を正しい単位に分割（`splitHiragana`関数）
- ローマ字パターンと1対1で対応させる
- 画面表示はひらがなをラベルとして、ローマ字部分をハイライト

---

## 5. 将来の拡張

- カタカナ対応
- 漢字変換を含む練習素材
- ユーザー定義の練習素材のインポート機能
