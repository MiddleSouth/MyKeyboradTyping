# MyKeyboardTyping - 練習素材管理仕様書

## 1. 概要

このドキュメントでは、タイピング練習の学習素材の定義、ローマ字↔ひらがな対応、素材の管理体系について記載します。

---

## 2. 練習素材の設計方針

### 2.1 素材の特徴

- **言語**: 日本語（ひらがな、カタカナ、漢字の混在テキスト）
- **入力方式**: ローマ字入力（ひらがなで表示、入力時に変換）
- **難易度**: easy / medium / hard の3段階
- **テキストサイズ**: 100～500文字（完了時間 2～10分 を想定）

### 2.2 素材構成

```
練習素材
├── カテゴリ1（基本）
│   ├── 素材1-1: 「あいうえお...」
│   ├── 素材1-2: 「かきくけこ...」
│   └── ...
├── カテゴリ2（文章）
│   ├── 素材2-1: 「今日は...」
│   ├── 素材2-2: 「私は...」
│   └── ...
└── カテゴリ3（実践）
    └── ...
```

---

## 3. ローマ字 ↔ ひらがな対応表

### 3.1 単音対応

| ローマ字 | ひらがな | 複数パターン対応 |
|---------|---------|---------|
| a | あ | |
| i | い | |
| u | う | |
| e | え | |
| o | お | |
| n | ん | ※末尾、または子音の直前 |

### 3.2 子音+母音（清音）

| ローマ字 | ひらがな | 複数パターン対応 |
|---------|---------|---------|
| ka | か | |
| ki | き | |
| ku | く | |
| ke | け | |
| ko | こ | |
| sa | さ | si → し |
| si | し | si, shi |
| su | す | |
| se | せ | |
| so | そ | |
| ta | た | |
| ti | ち | ti, chi |
| tu | つ | tu, tsu |
| te | て | |
| to | と | |
| na | な | |
| ni | に | |
| nu | ぬ | |
| ne | ね | |
| no | の | |
| ha | は | |
| hi | ひ | |
| fu | ふ | hu → ふ |
| he | へ | |
| ho | ほ | |
| ma | ま | |
| mi | み | |
| mu | む | |
| me | め | |
| mo | も | |
| ya | や | |
| yu | ゆ | |
| yo | よ | |
| ra | ら | |
| ri | り | |
| ru | る | |
| re | れ | |
| ro | ろ | |
| wa | わ | wa, ha（古い表記） |
| wi | ゐ | wi（古い） |
| we | ゑ | we（古い） |
| wo | を | o → を（助詞） |

### 3.3 小書き仮名（拗音）

| ローマ字 | ひらがな | 複数パターン対応 |
|---------|---------|---------|
| kya | きゃ | |
| kyu | きゅ | |
| kyo | きょ | |
| sha | しゃ | sha, sya |
| shu | しゅ | shu, syu |
| sho | しょ | sho, syo |
| cha | ちゃ | cha, tya |
| chu | ちゅ | chu, tyu |
| cho | ちょ | cho, tyo |
| nya | にゃ | |
| nyu | にゅ | |
| nyo | にょ | |
| hya | ひゃ | |
| hyu | ひゅ | |
| hyo | ひょ | |
| mya | みゃ | |
| myu | みゅ | |
| myo | みょ | |
| rya | りゃ | |
| ryu | りゅ | |
| ryo | りょ | |
| gya | ぎゃ | |
| gyu | ぎゅ | |
| gyo | ぎょ | |
| ja | じゃ | ja, zya |
| ju | じゅ | ju, zyu |
| jo | じょ | jo, zyo |
| bya | びゃ | |
| byu | びゅ | |
| byo | びょ | |
| pa | ぱ | |
| pya | ぴゃ | |
| pyu | ぴゅ | |
| pyo | ぴょ | |

### 3.4 濁音

| ローマ字 | ひらがな |
|---------|---------|
| ga | が |
| gi | ぎ |
| gu | ぐ |
| ge | げ |
| go | ご |
| za | ざ |
| zi | じ |
| zu | ず |
| ze | ぜ |
| zo | ぞ |
| da | だ |
| di | ぢ |
| du | づ |
| de | で |
| do | ど |
| ba | ば |
| bi | び |
| bu | ぶ |
| be | べ |
| bo | ぼ |

### 3.5 半濁音

| ローマ字 | ひらがな |
|---------|---------|
| pa | ぱ |
| pi | ぴ |
| pu | ぷ |
| pe | ぺ |
| po | ぽ |

### 3.6 小書き仮名（単独）

| ローマ字 | ひらがな | 入力方式 |
|---------|---------|---------|
| xa | ぁ | a の前に x をつける |
| xi | ぃ | i の前に x をつける |
| xu | ぅ | u の前に x をつける |
| xe | ぇ | e の前に x をつける |
| xo | ぉ | o の前に x をつける |
| xwa | ゎ | wa の前に x をつける |
| xya | ゃ | ya の前に x をつける |
| xyu | ゅ | yu の前に x をつける |
| xyo | ょ | yo の前に x をつける |

### 3.7 特殊パターン

| ローマ字 | ひらがな | 説明 |
|---------|---------|------|
| n | ん | 単独で「ん」（n後に子音がくる場合） |
| nn | ん | n の後に n をもう一度入力 |
| - | ー | 長音符（カタカナ時） |

---

## 4. ローマ字マッピング実装

### 4.1 TypeScript実装例

```typescript
// constants/romajiMap.ts

/**
 * ローマ字→ひらがなの変換マップ
 * 複数のローマ字表記に対応
 */
export const ROMAJI_TO_HIRAGANA: Record<string, string> = {
  // 単音
  'a': 'あ',
  'i': 'い',
  'u': 'う',
  'e': 'え',
  'o': 'お',
  
  // 清音
  'ka': 'か',
  'ki': 'き',
  'ku': 'く',
  'ke': 'け',
  'ko': 'こ',
  'sa': 'さ',
  'si': 'し',
  'shi': 'し',
  'su': 'す',
  'se': 'せ',
  'so': 'そ',
  'ta': 'た',
  'ti': 'ち',
  'chi': 'ち',
  'tu': 'つ',
  'tsu': 'つ',
  'te': 'て',
  'to': 'と',
  'na': 'な',
  'ni': 'に',
  'nu': 'ぬ',
  'ne': 'ね',
  'no': 'の',
  'ha': 'は',
  'hi': 'ひ',
  'hu': 'ふ',
  'fu': 'ふ',
  'he': 'へ',
  'ho': 'ほ',
  'ma': 'ま',
  'mi': 'み',
  'mu': 'む',
  'me': 'め',
  'mo': 'も',
  'ya': 'や',
  'yu': 'ゆ',
  'yo': 'よ',
  'ra': 'ら',
  'ri': 'り',
  'ru': 'る',
  're': 'れ',
  'ro': 'ろ',
  'wa': 'わ',
  'wo': 'を',
  'nn': 'ん',
  
  // 拗音
  'kya': 'きゃ',
  'kyu': 'きゅ',
  'kyo': 'きょ',
  'sha': 'しゃ',
  'sya': 'しゃ',
  'shu': 'しゅ',
  'syu': 'しゅ',
  'sho': 'しょ',
  'syo': 'しょ',
  'cha': 'ちゃ',
  'tya': 'ちゃ',
  'chu': 'ちゅ',
  'tyu': 'ちゅ',
  'cho': 'ちょ',
  'tyo': 'ちょ',
  'nya': 'にゃ',
  'nyu': 'にゅ',
  'nyo': 'にょ',
  'hya': 'ひゃ',
  'hyu': 'ひゅ',
  'hyo': 'ひょ',
  'mya': 'みゃ',
  'myu': 'みゅ',
  'myo': 'みょ',
  'rya': 'りゃ',
  'ryu': 'りゅ',
  'ryo': 'りょ',
  'gya': 'ぎゃ',
  'gyu': 'ぎゅ',
  'gyo': 'ぎょ',
  'ja': 'じゃ',
  'zya': 'じゃ',
  'ju': 'じゅ',
  'zyu': 'じゅ',
  'jo': 'じょ',
  'zyo': 'じょ',
  'bya': 'びゃ',
  'byu': 'びゅ',
  'byo': 'びょ',
  'pya': 'ぴゃ',
  'pyu': 'ぴゅ',
  'pyo': 'ぴょ',
  
  // 濁音
  'ga': 'が',
  'gi': 'ぎ',
  'gu': 'ぐ',
  'ge': 'げ',
  'go': 'ご',
  'za': 'ざ',
  'zi': 'じ',
  'zu': 'ず',
  'ze': 'ぜ',
  'zo': 'ぞ',
  'da': 'だ',
  'di': 'ぢ',
  'du': 'づ',
  'de': 'で',
  'do': 'ど',
  'ba': 'ば',
  'bi': 'び',
  'bu': 'ぶ',
  'be': 'べ',
  'bo': 'ぼ',
  
  // 半濁音
  'pa': 'ぱ',
  'pi': 'ぴ',
  'pu': 'ぷ',
  'pe': 'ぺ',
  'po': 'ぽ',
  
  // 小書き仮名
  'xa': 'ぁ',
  'xi': 'ぃ',
  'xu': 'ぅ',
  'xe': 'ぇ',
  'xo': 'ぉ',
  'xwa': 'ゎ',
  'xya': 'ゃ',
  'xyu': 'ゅ',
  'xyo': 'ょ',
};

/**
 * 複数の有効なローマ字表記を持つひらがな
 * マッチング優先度が必要な場合に使用
 */
export const HIRAGANA_MULTI_PATTERNS: Record<string, string[]> = {
  'し': ['si', 'shi'],
  'ち': ['ti', 'chi'],
  'つ': ['tu', 'tsu'],
  'ふ': ['hu', 'fu'],
  'しゃ': ['sha', 'sya'],
  'しゅ': ['shu', 'syu'],
  'しょ': ['sho', 'syo'],
  'ちゃ': ['cha', 'tya'],
  'ちゅ': ['chu', 'tyu'],
  'ちょ': ['cho', 'tyo'],
  'じゃ': ['ja', 'zya'],
  'じゅ': ['ju', 'zyu'],
  'じょ': ['jo', 'zyo'],
  'ん': ['n', 'nn'],
};
```

### 4.2 変換エンジン

```typescript
// composables/useRomajiConverter.ts

export function useRomajiConverter() {
  let buffer = '';
  
  /**
   * ローマ字文字を追加して変換を試みる
   */
  function addChar(char: string): RomajiConversionResult {
    buffer += char;
    
    // 最長マッチを探す
    for (let i = buffer.length; i > 0; i--) {
      const candidate = buffer.substring(0, i);
      
      if (ROMAJI_TO_HIRAGANA[candidate]) {
        const hiragana = ROMAJI_TO_HIRAGANA[candidate];
        buffer = buffer.substring(i);
        return {
          status: 'converted',
          hiragana,
          remaining: buffer,
        };
      }
    }
    
    // 部分マッチを確認（次の入力の可能性）
    if (hasPartialMatch(buffer)) {
      return {
        status: 'pending',
        remaining: buffer,
      };
    }
    
    // マッチしない
    return {
      status: 'error',
      invalid: buffer,
    };
  }
  
  /**
   * バッファをリセット
   */
  function reset() {
    buffer = '';
  }
  
  /**
   * 部分マッチをチェック
   */
  function hasPartialMatch(text: string): boolean {
    for (const key of Object.keys(ROMAJI_TO_HIRAGANA)) {
      if (key.startsWith(text)) {
        return true;
      }
    }
    return false;
  }
  
  return {
    addChar,
    reset,
    getBuffer: () => buffer,
  };
}

interface RomajiConversionResult {
  status: 'converted' | 'pending' | 'error';
  hiragana?: string;
  remaining?: string;
  invalid?: string;
}
```

---

## 5. ビルトイン練習素材

### 5.1 素材セット構成

```typescript
// constants/practiceContents.ts

export const PRACTICE_CONTENTS: PracticeContent[] = [
  // カテゴリ1: 基本
  {
    id: 'basic-01',
    title: '基本01: あいうえお',
    text: 'あいうえおあいうえおあいうえおあいうえおあいうえお',
    language: 'ja',
    difficulty: 'easy',
    category: '基本',
    estimatedTime: 60,
    createdAt: Date.now(),
  },
  {
    id: 'basic-02',
    title: '基本02: かきくけこ',
    text: 'かきくけこかきくけこかきくけこかきくけこかきくけこ',
    language: 'ja',
    difficulty: 'easy',
    category: '基本',
    estimatedTime: 60,
    createdAt: Date.now(),
  },
  // ... 他の基本素材
  
  // カテゴリ2: 文章
  {
    id: 'sentence-01',
    title: '文章01: 天気について',
    text: 'きょうはいいてんきですね。そとであそぶのにぴったりです。',
    language: 'ja',
    difficulty: 'medium',
    category: '文章',
    estimatedTime: 120,
    createdAt: Date.now(),
  },
  // ... 他の文章素材
];
```

### 5.2 初期素材例（日本語テキスト）

#### カテゴリ1: 基本（五十音）

**難易度: Easy**

```
01-1. あいうえお
「あいうえおあいうえおあいうえおあいうえおあいうえお」

01-2. かきくけこ
「かきくけこかきくけこかきくけこかきくけこかきくけこ」

01-3. さしすせそ
「さしすせそさしすせそさしすせそさしすせそさしすせそ」

01-4. たちつてと
「たちつてとたちつてとたちつてとたちつてとたちつてと」

01-5. なにぬねの
「なにぬねのなにぬねのなにぬねのなにぬねのなにぬねの」

01-6. はひふへほ
「はひふへほはひふへほはひふへほはひふへほはひふへほ」

01-7. まみむめも
「まみむめもまみむめもまみむめもまみむめもまみむめも」

01-8. やゆよ
「やゆよやゆよやゆよやゆよやゆよやゆよやゆよやゆよ」

01-9. らりるれろ
「らりるれろらりるれろらりるれろらりるれろらりるれろ」

01-10. わをん
「わをんわをんわをんわをんわをんわをんわをんわをん」
```

#### カテゴリ2: 拗音・拗濁音

**難易度: Easy～Medium**

```
02-1. しゃしゅしょ
「しゃしゅしょしゃしゅしょしゃしゅしょしゃしゅしょ」

02-2. ちゃちゅちょ
「ちゃちゅちょちゃちゅちょちゃちゅちょちゃちゅちょ」

02-3. ぎゃぎゅぎょ
「ぎゃぎゅぎょぎゃぎゅぎょぎゃぎゅぎょぎゃぎゅぎょ」

02-4. じゃじゅじょ
「じゃじゅじょじゃじゅじょじゃじゅじょじゃじゅじょ」

02-5. びゃびゅびょ
「びゃびゅびょびゃびゅびょびゃびゅびょびゃびゅびょ」

02-6. ぴゃぴゅぴょ
「ぴゃぴゅぴょぴゃぴゅぴょぴゃぴゅぴょぴゃぴゅぴょ」

02-7. きゃきゅきょ
「きゃきゅきょきゃきゅきょきゃきゅきょきゃきゅきょ」
```

#### カテゴリ3: 単語

**難易度: Medium**

```
03-1. 基本単語1
「りんご、みかん、ぶどう、いちご、すいか、もも、なし」

03-2. 基本単語2
「あさ、ひる、よる、あした、きょう、きのう、らいしゅう」

03-3. 基本単語3
「あか、あお、きいろ、しろ、くろ、みどり、むらさき」

03-4. 基本単語4
「ねこ、いぬ、とり、さかな、さる、ぶた、うし」

03-5. 動詞
「たべる、のむ、あるく、はしる、ねる、おきる、あそぶ」
```

#### カテゴリ4: 文章

**難易度: Medium～Hard**

```
04-1. 短編1
「きょうはいいてんきですね。そとであそぶのにぴったりです。
こうえんにいきましょう。」

04-2. 短編2
「わたしは、まいにちがっこうにいきます。
ともだちといっしょに、べんきょうします。」

04-3. 短編3
「しゅうまつは、かぞくでおでかけします。
どこにいくのか、とてもたのしみです。」

04-4. 短編4
「りんごは、あかくて、あまいです。
みずみずしくて、けんこうにいいです。」

04-5. 短編5
「せんせいは、きょうしつでべんきょうを、おしえてくれます。
みんなで、ちゅういぶかくききましょう。」
```

---

## 6. 素材の管理

### 6.1 素材グループ化

```typescript
// constants/practiceContentGroups.ts

export const PRACTICE_CONTENT_GROUPS: PracticeContentGroup[] = [
  {
    id: 'basic-group',
    name: '基本（五十音）',
    description: 'ひらがなの基本である五十音を練習します。',
    contents: PRACTICE_CONTENTS.filter(c => c.category === '基本' && c.difficulty === 'easy'),
  },
  {
    id: 'koyouon-group',
    name: '拗音・拗濁音',
    description: 'きゃ、しゃなどの小書き仮名を含む音を練習します。',
    contents: PRACTICE_CONTENTS.filter(c => c.category.includes('拗')),
  },
  {
    id: 'word-group',
    name: '単語',
    description: '日本語の基本的な単語を練習します。',
    contents: PRACTICE_CONTENTS.filter(c => c.category === '単語'),
  },
  {
    id: 'sentence-group',
    name: '文章',
    description: '短い文章を通じた実践的なタイピング練習をします。',
    contents: PRACTICE_CONTENTS.filter(c => c.category === '文章'),
  },
];
```

---

## 7. 将来拡張

### 7.1 ユーザー素材対応

```typescript
// 実装予定（スコープ外）
interface UserPracticeContent extends PracticeContent {
  userId: string;
  uploadedAt: number;
  isPrivate: boolean;
}
```

### 7.2 漢字対応

```typescript
// 実装予定（スコープ外）
interface KanjiConversionRule {
  hiragana: string;
  kanji: string;
  example: string;
}
```

---

## 8. チェックリスト

- [ ] ROMAJI_TO_HIRAGANA マップを完成させる
- [ ] useRomajiConverter composable を実装
- [ ] PRACTICE_CONTENTS を全素材分定義
- [ ] PRACTICE_CONTENT_GROUPS を定義
- [ ] 素材ローテーション機能実装
- [ ] 素材選択UI実装
- [ ] 複数パターンローマ字対応確認テスト実施
